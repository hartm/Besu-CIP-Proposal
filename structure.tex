%!TEX root = ./main.tex

\section{Program Structure} \label{sec:structure}
In this section, we define the structure of the main progrmam.  We emphasize that the program aims to provide long-term support and incentives for teams towards maintaining reliable clients and a healthy network overall.

For client teams to be eligible, they should already be contributing to the general development of Ethereum and intend to support the upcoming transition to proof of stake. Throughout the program, teams will need to maintain certain levels of performance to be eligible for the rewards.  We explain which maintainers and organizations are eligible for which rewards later in this document.

The Hyperledger Besu client, unlike other Ethereum clients, is maintained by several organizations and is part of the Hyperledger Foundation. This document, and the values referenced, represent the entirety of the incentive program for all teams maintaining Hyperledger Besu. Once again, we emphasize that the EF reserves full discretion about how funds from the program are distributed across the various teams contributing to Hyperledger Besu.

The overall process of the program can be summarized as follows:
\begin{itemize}
\item The EF makes deposits into accounts controlled by withdrawal keys.
\item The EF transfers control of the validator keys to the node operators.
\item The node operators run the validators.
\item The EF releases the withdrawal credentials to patron organizations and maintainers in waves.
\end{itemize}

We explain each of these steps in more detail below.  Note that none of these steps explicitly require HLF involvement; however, the success of the program (and the release of the withdrawal credentials) is dependent on the Besu client meeting various requirements which implicitly involves the HLF.

\subsection{Parameter Definitions}
We begin by defining some parameters that will be used in the following section.  We define them here so that they may be potentially changed in updated versions of this document easily.
\[
\begin{array}{|l|l|l|}
\hline
\textbf{Name} & \textbf{Value} & \textbf{Description} \\
\hline
NUM\_PERFORMANCE & 128 & \text{Number of validators monitored for performance} \\
\hline
NUM\_CANARIES & 16 & \text{Number of canary vaildators} \\
\hline
NUM\_VALIDATORS & NUM\_PERFORMANCE & \text{Total number of validators} \\
&  + NUM\_CANARIES & \\
\hline
INITIAL\_RELEASE & 32 & \text{Number of validators to release} \\
& &  \text{at initial major milestone} \\
\hline
TIMED\_RELEASES & 6, 10, 14, 15, 22, & \text{Number of validators to be released each} \\
& 26 + NUM\_CANARIES & \text{grant period after } INITIAL\_RELEASE \\
\hline
METRICS\_WINDOW & 8192 & \text{Number of epochs over which} \\
& & \text{success metrics are observed} \\
\hline
MAX\_PROBATION\_WINDOW & 32768 & \text{Maximum number of epochs that the} \\
& & \text{client can be in probation before the EF} \\
& & \text{can partially or fully remove the client} \\
& & \text{from the incentivization.} \\
\hline
\end{array}
\]

\subsection{Step 1:  The EF Makes Deposits}
After Hyperledger Besu has formally agreed to join the CIP, and a node operator, responsible for running and monitoring validators, has been selected by the EF, the EF creates $NUM\_VALIDATORS$ $32$-ETH deposits.  For exactly how this process occurs, please see~\cite{EthVal}.

Note that the total ETH at stake in the client incentivization plan is equal to $NUM\_VALIDATORS * 32$. In consultation with the node operator, a formal start date for this program will be determined where teams will gain control of validators, sometime before ``The Merge'' occurs.

\subsection{Step 2:  The EF Transfers Validator Keys}
After step 1, there will be $NUM\_VALIDATORS$ sets of validator keys, each of which is a (signing key, public key) tuple. These keys must be securely transferred to the client team node operator.

These keys are transfered to the Client via one of the following:
\begin{itemize}
\item Using asymmetric encryption (e.g. PGP) via a known/validated public key of the recipient client.
\item Read verbally 25\% at a time over $4$ encrypted calls of various platforms.
\item Through an alternatively negotiated, cryptographically secure means.
\end{itemize}

\textcolor{red}{TIM:  The original texts suggest there is a mnemonic that can be used to generate all of these keys.  I'd prefer to refer to this as a key delegation mechanism.  Can you explain the delegation mechanism that is used?  I am assuming you are probably generating a random seed, applying a PRG or a random oracle to expand it, and then feeding that randomness into the BLS key generation algorithm, but it might be useful to be more explicit here.  We should also probably mention this in step 1?}

The client node operator then generates $NUM\_VALIDATORS$ and verifies that the key pairs are correct. The EF retains the keys in cold storage in the event that validator keys must be used to exit validators from the program.


\subsection{Step 3:  The Validators Run}
At this point, the node operator is in charge of the management of the associated validators until withdrawal credential privkeys are released. Specifically, the client node operator must use Hyperledger Besu as an execution-engine and is responsible for choosing and maintaining a consensus-engine throughout the incentivization period.

\textcolor{green}{GRACE:  I'm assuming you are going to use Teku here?  Can you confirm this?}

Performance of the Clientâ€™s validators can be assessed simply by viewing chain metrics, but additional node performance metrics might be requested.

Once the merge has occurred (and ``real'' transactions happen on the beacon chain), the node operator will send transaction fees to the splitter contract defined in section~\ref{sec:splitter}. In other words, the node operator will designate the $feeRecipient$ in the $ExecutionaPayload$ to be the splitter contract.

\subsection{Step 4:  Withdrawal Credentials Released}
Eventually the EF will release withdrawal credentials to patron organizations (and potentially maintainers) as it sees fit.  When a wave of validators is released, this ends the obligation of both the node operator and the withdrawal credential receipient to the EF for those validators. The withdrawal credential receipients are free to choose to continue to validate, to exit, to withdraw, to spend the entire credential buying Hart beer, and so forth.

Note that if recipients choose to continue to validate, they are no longer required to allocate transaction fees/validator rewards to the splitter contract.
